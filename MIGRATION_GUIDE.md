# Руководство по переносу логики iDnevnik

Это руководство поможет перенести функционал (бэкенд и логику) на новый проект с другим дизайном.

## ЭТАП 1: База Данных (Supabase)

В новом проекте в SQL Editor выполните следующие команды по очереди, чтобы создать структуру.

### 1. Таблицы
```sql
-- Профили пользователей (расширение auth.users)
create table public.profiles (
  id uuid references auth.users not null primary key,
  auth_id uuid references auth.users,
  full_name text,
  updated_at timestamp with time zone,
  constraint auth_id_unique unique(auth_id)
);

-- Роли (admin, teacher, student, parent)
create table public.user_roles (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users not null,
  role text not null check (role in ('admin', 'teacher', 'student', 'parent')),
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Классы
create table public.school_classes (
  id bigint generated by default as identity primary key,
  name text not null,
  academic_year text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Предметы
create table public.subjects (
  id bigint generated by default as identity primary key,
  name text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Расписание
create table public.schedule (
  id bigint generated by default as identity primary key,
  class_id bigint references public.school_classes,
  subject_id bigint references public.subjects,
  teacher_id uuid references auth.users,
  day_of_week text not null, -- 'monday', etc.
  start_time time not null,
  room text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Домашние задания
create table public.homework (
  id bigint generated by default as identity primary key,
  class_id bigint references public.school_classes,
  subject_id bigint references public.subjects,
  date date not null,
  description text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Оценки
create table public.grades (
  id bigint generated by default as identity primary key,
  student_id uuid references auth.users,
  subject_id bigint references public.subjects,
  grade integer not null,
  date date default now(),
  type text, -- 'homework', 'exam', etc.
  teacher_id uuid references auth.users,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);
```

### 2. Важные настройки
Не забудьте отключить RLS или настроить политики (Policies) в Supabase, иначе данные не будут загружаться.

---

## ЭТАП 2: Фронтенд - Ядро (Копировать файлы целиком)

Эти файлы отвечают за логику соединения и авторизацию. Их можно перенести в новый проект практически без изменений.

1.  **Зависимости** (установите в новом проекте):
    ```bash
    npm i @supabase/supabase-js @tanstack/react-query date-fns lucide-react react-router-dom
    ```

2.  **Файлы для копирования** (из `src/` в `src/`):
    *   `integrations/supabase/client.ts` (настройка соединения)
    *   `contexts/AuthContext.tsx` (логика входа/выхода и ролей)
    *   `hooks/use-toast.ts` (если будете использовать тосты)
    *   `lib/utils.ts` (утилиты классов)

---

## ЭТАП 3: Перенос Компонентов (Метод "Хирургия")

Здесь вы берете **логику** из старого файла и вставляете в **новый дизайн**.

### Пример: Журнал учителя

**1. Откройте старый файл:** `src/components/teacher/TeacherJournal.tsx`

**2. Скопируйте "Мозги" (Logic):**
Все, что находится **мeжду** началом функции и `return (`.

```typescript
// --- КОПИРОВАТЬ ЭТО ---
const [date, setDate] = useState<Date>(new Date());
const [selectedClass, setSelectedClass] = useState<string>("");
// ... все useEffect ...
// ... функции fetchGrades, handleGradeSubmit ...
// ----------------------
```

**3. Вставьте в новый компонент:**
В новом проекте создайте компонент (например, `BlueThemeJournal.tsx`) и вставьте скопированную логику.

**4. Напишите новую верстку (UI):**
Вместо старого `return (...)`, напишите новый HTML/JSX, используя классы вашего нового дизайна, но подставляя переменные из логики.

```tsx
return (
  // Ваш НОВЫЙ дизайн
  <div className="new-fancy-container">
     <h1 className="pink-text">Журнал</h1>
     
     {/* Используем логику (переменную date) в новом дизайне */}
     <span>Выбрана дата: {format(date, 'dd.MM')}</span>

     {/* Используем логику (функцию setDate) в новом календаре */}
     <NewCalendarComponent onChange={setDate} />
  </div>
)
```

## ЭТАП 4: Чек-лист файлов с логикой

Пройдитесь по этим файлам и заберите из них функции запросов к базе:

- [ ] **AdminUsers.tsx** -> Логика создания пользователя (`supabase.functions.invoke`).
- [ ] **AdminClasses.tsx** -> Логика создания/удаления классов.
- [ ] **TeacherGrades.tsx** -> Логика таблицы оценок.
- [ ] **StudentSchedule.tsx** -> Логика расписания и текущего урока.
