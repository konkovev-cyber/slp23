<?php
/**
 * ðŸ“¦ Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸ deploy.zip Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ
 * 
 * Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ:
 * 1. Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ ÑÑ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð» Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€ Ñ‡ÐµÑ€ÐµÐ· FTP
 * 2. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ: https://slp23.ru/_unzip.php
 * 3. ÐŸÐ¾ÑÐ»Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð¹ Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸ ÑƒÐ´Ð°Ð»Ð¸Ñ‚Ðµ ÑÑ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð»!
 * 
 * âš ï¸ Ð’ÐÐ˜ÐœÐÐÐ˜Ð•: Ð£Ð´Ð°Ð»Ð¸Ñ‚Ðµ ÑÑ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð» Ð¿Ð¾ÑÐ»Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ!
 */

// Ð˜Ð¼Ñ Ð°Ñ€Ñ…Ð¸Ð²Ð° (Ð´Ð¾Ð»Ð¶Ð½Ð¾ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°Ñ‚ÑŒ Ñ zipFileName Ð² ftp-deploy.js)
$file = 'deploy.zip';

set_time_limit(300);

if (!file_exists($file)) {
    http_response_code(404);
    die("âŒ Error: $file not found. Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð°Ñ€Ñ…Ð¸Ð² Ñ‡ÐµÑ€ÐµÐ· FTP.");
}

echo "ðŸ“¦ Ð Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÐ° $file...\n";

$zip = new ZipArchive;
if ($zip->open($file) === TRUE) {
    $extracted = $zip->extractTo(__DIR__);
    $zip->close();
    
    if ($extracted) {
        echo "âœ… Ð Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÐ° ÑƒÑÐ¿ÐµÑˆÐ½Ð°!\n";
        
        // Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð°Ñ€Ñ…Ð¸Ð² Ð¿Ð¾ÑÐ»Ðµ Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸
        if (unlink($file)) {
            echo "ðŸ—‘ï¸  ÐÑ€Ñ…Ð¸Ð² ÑƒÐ´Ð°Ð»Ñ‘Ð½\n";
        } else {
            echo "âš ï¸  ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð°Ñ€Ñ…Ð¸Ð²\n";
        }
        
        echo "\nâœ… Ð”Ð•ÐŸÐ›ÐžÐ™ Ð—ÐÐ’Ð•Ð Ð¨ÐÐ!\n";
        echo "ðŸ“ Ð£Ð´Ð°Ð»Ð¸Ñ‚Ðµ ÑÑ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð» (_unzip.php) Ð´Ð»Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸\n";
    } else {
        http_response_code(500);
        echo "âŒ Error: Failed to extract files\n";
    }
} else {
    http_response_code(500);
    echo "âŒ Error: Cannot open zip file\n";
}
?>
