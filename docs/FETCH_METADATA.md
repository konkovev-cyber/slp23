# üìö –§—É–Ω–∫—Ü–∏—è fetch-metadata ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-19  
**–í–µ—Ä—Å–∏—è:** 3.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Edge Function `fetch-metadata` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
- Telegram –∫–∞–Ω–∞–ª—ã
- YouTube –≤–∏–¥–µ–æ
- –Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω
- –í–µ–±-—Å–∞–π—Ç—ã —Å Open Graph

---

## üìä –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

| –ò—Å—Ç–æ—á–Ω–∏–∫ | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|------|----------|
| **Telegram** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | t.me/lichnost_PLUS/441 | –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ |
| **YouTube** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | youtube.com/watch?v=... | –ù–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, thumbnail |
| **–Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω** | ‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç | zen.yandex.ru/... | –ó–∞–≥–æ–ª–æ–≤–æ–∫, –æ–ø–∏—Å–∞–Ω–∏–µ (–≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π) |
| **–í–µ–±-—Å–∞–π—Ç—ã** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ª—é–±—ã–µ —Å–∞–π—Ç—ã | Open Graph –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ |
| **VK** | ‚ùå –û—Ç–∫–ª—é—á—ë–Ω | ‚Äî | –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ VK API |

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://slp23.ru/admin/news
2. –ù–∞–∂–º–∏—Ç–µ **"–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å"**
3. –í –ø–æ–ª–µ **"–ò–º–ø–æ—Ä—Ç –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤"** –≤—Å—Ç–∞–≤—å—Ç–µ URL
4. –ù–∞–∂–º–∏—Ç–µ **"–ò–º–ø–æ—Ä—Ç"**
5. –î–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ß–µ—Ä–µ–∑ API

```bash
# Telegram
curl -X POST https://qwuicyhadpesklhkjxpn.supabase.co/functions/v1/fetch-metadata \
  -H "Content-Type: application/json" \
  -d "{\"url\": \"https://t.me/lichnost_PLUS/441\"}"

# YouTube
curl -X POST https://qwuicyhadpesklhkjxpn.supabase.co/functions/v1/fetch-metadata \
  -H "Content-Type: application/json" \
  -d "{\"url\": \"https://www.youtube.com/watch?v=dQw4w9WgXcQ\"}"

# –í–µ–±-—Å–∞–π—Ç
curl -X POST https://qwuicyhadpesklhkjxpn.supabase.co/functions/v1/fetch-metadata \
  -H "Content-Type: application/json" \
  -d "{\"url\": \"https://meduza.io\"}"
```

---

## üìã –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

```json
{
  "title": "–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏",
  "description": "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ",
  "content": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞",
  "image": "https://... URL –æ–±–ª–æ–∂–∫–∏",
  "mediaList": [
    {"url": "https://...", "type": "image"},
    {"url": "https://...", "type": "video"}
  ],
  "source": "telegram|youtube|zen|web"
}
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Telegram

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç embed —Ä–µ–∂–∏–º (`?embed=1`)
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ `.tgme_widget_message_text`
- –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –≤–∏–¥–µ–æ
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç telegra.ph –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### YouTube

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Open Graph –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, thumbnail
- –ù–∞—Ö–æ–¥–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Open Graph –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π (UTF-8 vs Windows-1251)

### –í–µ–±-—Å–∞–π—Ç—ã

- –ò–∑–≤–ª–µ–∫–∞–µ—Ç Open Graph: `og:title`, `og:description`, `og:image`
- Fallback –Ω–∞ `<title>` –∏ `<meta name="description">`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Twitter Cards

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. VK –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** VK –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ VK API.

**–†–µ—à–µ–Ω–∏–µ:** –î–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ VK –Ω—É–∂–Ω–æ:
1. –°–æ–∑–¥–∞—Ç—å VK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–æ–ª—É—á–∏—Ç—å user access token
3. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É VK API –≤ —Ñ—É–Ω–∫—Ü–∏—é

### 2. –î–∑–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∞–∫–æ–∑—è–±—Ä—ã

**–ü—Ä–∏—á–∏–Ω–∞:** –Ø–Ω–¥–µ–∫—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–æ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∫–æ–¥–∏—Ä–æ–≤–æ–∫.

**–†–µ—à–µ–Ω–∏–µ:** –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏.

### 3. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ Telegram –∫–∞–Ω–∞–ª—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–∞–Ω–∞–ª –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∏–ª–∏ —É–¥–∞–ª—ë–Ω–Ω—ã–º.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

---

## üìù –õ–æ–≥–∏

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤:
1. https://supabase.com/dashboard/project/qwuicyhadpesklhkjxpn/logs
2. –§–∏–ª—å—Ç—Ä: `fetch-metadata`

**–ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤:**
```
DEBUG: Telegram URL: https://t.me/channel/123?embed=1
DEBUG: Content-Type: text/html; charset=utf-8
DEBUG: HTML length: 45678
DEBUG: Trying Telegram selectors...
DEBUG: TG Selector: ... Match: YES
DEBUG: Found Telegram content, length: 523
DEBUG: Media list count: 6
```

---

## üîÑ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –í–µ—Ä—Å–∏—è 3.0 (2026-02-19)
- ‚ùå –£–¥–∞–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ VK (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Telegram
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –î–∑–µ–Ω
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ Open Graph

### –í–µ—Ä—Å–∏—è 2.0 (2026-02-18)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ YouTube
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–æ–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í–µ—Ä—Å–∏—è 1.0 (2026-02-17)
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Telegram
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ–±-—Å–∞–π—Ç–æ–≤

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Supabase Dashboard
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç URL
