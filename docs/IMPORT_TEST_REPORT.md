# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** 2026-02-19  
**–§—É–Ω–∫—Ü–∏—è:** `fetch-metadata`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

### ‚úÖ Telegram ‚Äî –†–ê–ë–û–¢–ê–ï–¢

**–¢–µ—Å—Ç:**
```bash
curl -X POST https://qwuicyhadpesklhkjxpn.supabase.co/functions/v1/fetch-metadata \
  -H "Content-Type: application/json" \
  -d "{\"url\": \"https://t.me/lichnost_PLUS/441\"}"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "title": "–ù–∞ –∑–∞–Ω—è—Ç–∏—è—Ö \"–§–∞–∫—Ç—ã –∏—Å—Ç–æ—Ä–∏–∏\" –ø—Ä–æ—à—ë–ª —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–∏–¥–µ–æ—É—Ä–æ–∫...",
  "description": "",
  "content": "–ù–∞ –∑–∞–Ω—è—Ç–∏—è—Ö \"–§–∞–∫—Ç—ã –∏—Å—Ç–æ—Ä–∏–∏\" –ø—Ä–æ—à—ë–ª —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–∏–¥–µ–æ—É—Ä–æ–∫...",
  "image": "https://cdn4.telesco.pe/file/...",
  "mediaList": [6 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π],
  "source": "telegram"
}
```

**–û—Ü–µ–Ω–∫–∞:**
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫: –∏–∑–≤–ª–µ—á—ë–Ω
- ‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç: –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å —ç–º–æ–¥–∑–∏
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: –Ω–∞–π–¥–µ–Ω–æ 6 —à—Ç—É–∫
- ‚úÖ –ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF-8 (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

---

### ‚úÖ YouTube ‚Äî –†–ê–ë–û–¢–ê–ï–¢

**–¢–µ—Å—Ç:**
```bash
curl -X POST https://qwuicyhadpesklhkjxpn.supabase.co/functions/v1/fetch-metadata \
  -H "Content-Type: application/json" \
  -d "{\"url\": \"https://www.youtube.com/watch?v=dQw4w9WgXcQ\"}"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "title": "Rick Astley - Never Gonna Give You Up (Official Video) (4K Remaster)",
  "description": "The official video for...",
  "content": "The official video for...",
  "image": "https://i.ytimg.com/vi/dQw4w9WgXcQ/maxresdefault.jpg",
  "mediaList": [...],
  "source": "youtube"
}
```

**–û—Ü–µ–Ω–∫–∞:**
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫: –∏–∑–≤–ª–µ—á—ë–Ω
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ: –∏–∑–≤–ª–µ—á–µ–Ω–æ
- ‚úÖ Thumbnail: –Ω–∞–π–¥–µ–Ω
- ‚úÖ –ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF-8 (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

---

### ‚ö†Ô∏è –Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω ‚Äî –†–ê–ë–û–¢–ê–ï–¢ –° –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø–ú–ò

**–¢–µ—Å—Ç:**
```bash
curl -X POST https://qwuicyhadpesklhkjxpn.supabase.co/functions/v1/fetch-metadata \
  -H "Content-Type: application/json" \
  -d "{\"url\": \"https://zen.yandex.ru\"}"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "title": "–ù–æ–≤–æ—Å—Ç–∏",
  "description": "",
  "source": "zen"
}
```

**–û—Ü–µ–Ω–∫–∞:**
- ‚ö†Ô∏è –ó–∞–≥–æ–ª–æ–≤–æ–∫: –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–µ –≤—Å–µ–≥–¥–∞
- ‚ö†Ô∏è –ö–æ–¥–∏—Ä–æ–≤–∫–∞: –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã (UTF-8 vs Windows-1251)
- ‚úÖ Source: –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### ‚úÖ –í–µ–±-—Å–∞–π—Ç—ã (Open Graph) ‚Äî –†–ê–ë–û–¢–ê–ï–¢

**–¢–µ—Å—Ç:**
```bash
curl -X POST https://qwuicyhadpesklhkjxpn.supabase.co/functions/v1/fetch-metadata \
  -H "Content-Type: application/json" \
  -d "{\"url\": \"https://meduza.io\"}"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "title": "Meduza ‚Äî –ù–æ–≤–æ—Å—Ç–∏",
  "description": "...",
  "image": "...",
  "source": "web"
}
```

**–û—Ü–µ–Ω–∫–∞:**
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫: –∏–∑–≤–ª–µ—á—ë–Ω (Open Graph)
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ: –∏–∑–≤–ª–µ—á–µ–Ω–æ
- ‚úÖ –ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF-8 (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

---

### ‚ùå VK ‚Äî –û–¢–ö–õ–Æ–ß–Å–ù

**–ü—Ä–∏—á–∏–Ω–∞:** VK –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã.

**–¢–µ—Å—Ç—ã:**
- ‚ùå –ü—Ä—è–º–æ–π –ø–∞—Ä—Å–∏–Ω–≥ HTML ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- ‚ùå VK API (service token) ‚Äî –º–µ—Ç–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- ‚ùå VK API (user token) ‚Äî —Ç–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
- ‚ùå microlink.io ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
–î–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ VK –Ω—É–∂–Ω–æ:
1. –°–æ–∑–¥–∞—Ç—å VK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–π user access token
3. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É VK API –≤ —Ñ—É–Ω–∫—Ü–∏—é

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ò—Å—Ç–æ—á–Ω–∏–∫ | –ó–∞–≥–æ–ª–æ–≤–æ–∫ | –ö–æ–Ω—Ç–µ–Ω—Ç | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è | –ö–æ–¥–∏—Ä–æ–≤–∫–∞ | –°—Ç–∞—Ç—É—Å |
|----------|-----------|---------|-------------|-----------|--------|
| **Telegram** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **YouTube** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **–î–∑–µ–Ω** | ‚ö†Ô∏è | ‚ö†Ô∏è | ‚ö†Ô∏è | ‚ö†Ô∏è | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ |
| **–í–µ–±-—Å–∞–π—Ç—ã** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **VK** | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå –û—Ç–∫–ª—é—á—ë–Ω |

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏

### –ö–∞–∫ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏:

1. **Telegram:**
   - –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç: `https://t.me/channel/123`
   - –ù–∞–∂–º–∏—Ç–µ "–ò–º–ø–æ—Ä—Ç"
   - ‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω—è—Ç—Å—è

2. **YouTube:**
   - –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ: `https://youtube.com/watch?v=...`
   - –ù–∞–∂–º–∏—Ç–µ "–ò–º–ø–æ—Ä—Ç"
   - ‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω—è—Ç—Å—è

3. **–í–µ–±-—Å–∞–π—Ç—ã:**
   - –í—Å—Ç–∞–≤—å—Ç–µ URL —Å—Ç–∞—Ç—å–∏
   - –ù–∞–∂–º–∏—Ç–µ "–ò–º–ø–æ—Ä—Ç"
   - ‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω—è—Ç—Å—è (–µ—Å–ª–∏ –µ—Å—Ç—å Open Graph)

4. **VK:**
   - ‚ö†Ô∏è –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ö–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤—Ä—É—á–Ω—É—é

---

## üîß –õ–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏:
1. https://supabase.com/dashboard/project/qwuicyhadpesklhkjxpn/logs
2. –§–∏–ª—å—Ç—Ä: `fetch-metadata`

**–û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
DEBUG: Telegram URL: https://t.me/...
DEBUG: Content-Type: text/html; charset=utf-8
DEBUG: HTML length: 45678
DEBUG: Trying Telegram selectors...
DEBUG: TG Selector: ... Match: YES
DEBUG: Found Telegram content, length: 523
DEBUG: Media list count: 6
```

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–§—É–Ω–∫—Ü–∏—è `fetch-metadata` **–≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é** –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏–∑:
- ‚úÖ Telegram
- ‚úÖ YouTube
- ‚úÖ –í–µ–±-—Å–∞–π—Ç–æ–≤

**–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚ùå VK (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- ‚ö†Ô∏è –î–∑–µ–Ω (–ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π)
