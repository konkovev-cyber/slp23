# –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è MAX.ru Messenger API

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ MAX.ru –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ª—é–±—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.

---

## –û–±–∑–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

**MAX.ru** ‚Äî —Ä–æ—Å—Å–∏–π—Å–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç-–±–æ—Ç–æ–≤ –∏ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∞–Ω–∞–ª–æ–≥ Telegram Bot API.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–¥–∏–∞ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ñ–∞–π–ª—ã)
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–∫–Ω–æ–ø–∫–∏)
- ‚úÖ Webhook –∏ Long Polling –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (Markdown/HTML)
- ‚úÖ –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã
- ‚úÖ –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (WebApps)

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- **Rate Limit**: 30 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: –¢–æ–ª—å–∫–æ HTTPS (HTTP –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
- **–¢–æ–∫–µ–Ω**: –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–∞ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ MAX –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤

---

## –≠—Ç–∞–ø 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–∞

### 1.1 –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [–ø–ª–∞—Ç—Ñ–æ—Ä–º—É MAX –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤](https://partner.max.ru)
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏ —Å–æ–∑–¥–∞–π—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
3. –ü—Ä–æ–π–¥–∏—Ç–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ò–ù–ù)

### 1.2 –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç-–±–æ—Ç–∞
1. –í —Ä–∞–∑–¥–µ–ª–µ **¬´–ß–∞—Ç-–±–æ—Ç—ã¬ª** –Ω–∞–∂–º–∏—Ç–µ **¬´–°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞¬ª**
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ**: –ò–º—è –±–æ—Ç–∞ (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —á–∞—Ç–∞—Ö)
   - **–õ–æ–≥–æ—Ç–∏–ø**: –ê–≤–∞—Ç–∞—Ä –±–æ—Ç–∞ (PNG/JPG, –¥–æ 5 –ú–ë)
   - **–û–ø–∏—Å–∞–Ω–∏–µ**: –ß—Ç–æ —É–º–µ–µ—Ç –±–æ—Ç, –∫–∞–∫ —Å –Ω–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (–æ–±—ã—á–Ω–æ 1-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è)

### 1.3 –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
1. –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚Üí –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω (—Ñ–æ—Ä–º–∞—Ç: `AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw`)
3. **–í–∞–∂–Ω–æ**: –•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Å–µ–∫—Ä–µ—Ç–µ (`.env` —Ñ–∞–π–ª, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)

---

## –≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 2.1 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```env
MAX_BOT_TOKEN=AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw
MAX_API_URL=https://platform-api.max.ru
MAX_WEBHOOK_URL=https://yourdomain.com/webhook/max
```

### 2.2 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**Node.js/TypeScript:**
```bash
npm install axios dotenv
# –ò–ª–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
npm install @max-messenger/max-bot-api-client-ts
```

**Python:**
```bash
pip install requests python-dotenv
```

**Go:**
```bash
go get github.com/max-messenger/max-bot-api-client-go
```

---

## –≠—Ç–∞–ø 3: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

### 3.1 –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä (Node.js)

```typescript
import axios from 'axios';

const MAX_API_URL = process.env.MAX_API_URL;
const BOT_TOKEN = process.env.MAX_BOT_TOKEN;

async function sendMessage(chatId: string, text: string) {
  try {
    const response = await axios.post(
      `${MAX_API_URL}/messages`,
      {
        chat_id: chatId,
        text: text,
      },
      {
        headers: {
          'Authorization': BOT_TOKEN,
          'Content-Type': 'application/json',
        },
      }
    );
    
    return response.data;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error.response?.data || error.message);
    throw error;
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
sendMessage('user_chat_id_123', '–ü—Ä–∏–≤–µ—Ç –∏–∑ MAX.ru!');
```

### 3.2 –° —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º (Markdown)

```typescript
async function sendFormattedMessage(chatId: string) {
  return axios.post(
    `${MAX_API_URL}/messages`,
    {
      chat_id: chatId,
      text: '*–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç*\n_–ö—É—Ä—Å–∏–≤_\n`–ö–æ–¥`',
      format: {
        type: 'markdown',
      },
    },
    {
      headers: { 'Authorization': BOT_TOKEN },
    }
  );
}
```

### 3.3 –° –∫–Ω–æ–ø–∫–∞–º–∏ (–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞)

```typescript
async function sendWithButtons(chatId: string) {
  return axios.post(
    `${MAX_API_URL}/messages`,
    {
      chat_id: chatId,
      text: '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:',
      keyboard: {
        buttons: [
          [
            { text: '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å', callback_data: 'confirm' },
            { text: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å', callback_data: 'cancel' },
          ],
        ],
      },
    },
    {
      headers: { 'Authorization': BOT_TOKEN },
    }
  );
}
```

### 3.4 –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```typescript
async function sendImage(chatId: string, imageUrl: string, caption?: string) {
  return axios.post(
    `${MAX_API_URL}/messages`,
    {
      chat_id: chatId,
      attachments: [
        {
          type: 'image',
          payload: { url: imageUrl },
        },
      ],
      text: caption || '',
    },
    {
      headers: { 'Authorization': BOT_TOKEN },
    }
  );
}
```

---

## –≠—Ç–∞–ø 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### 4.1 Webhook (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook

```typescript
async function setupWebhook(webhookUrl: string) {
  return axios.post(
    `${MAX_API_URL}/subscriptions`,
    {
      url: webhookUrl,
      version: '1.0',
    },
    {
      headers: { 'Authorization': BOT_TOKEN },
    }
  );
}

// –í—ã–∑–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
setupWebhook(process.env.MAX_WEBHOOK_URL);
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (Express.js)

```typescript
import express from 'express';

const app = express();
app.use(express.json());

app.post('/webhook/max', async (req, res) => {
  const update = req.body;
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  if (update.message) {
    const chatId = update.message.chat.id;
    const text = update.message.text;
    
    console.log(`–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: ${text} –æ—Ç ${chatId}`);
    
    // –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    await sendMessage(chatId, `–í—ã –Ω–∞–ø–∏—Å–∞–ª–∏: ${text}`);
  }
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
  if (update.callback_query) {
    const callbackData = update.callback_query.data;
    const chatId = update.callback_query.message.chat.id;
    
    if (callbackData === 'confirm') {
      await sendMessage(chatId, '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ!');
    }
  }
  
  res.sendStatus(200);
});

app.listen(3000, () => console.log('Webhook —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω'));
```

### 4.2 Long Polling (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```typescript
async function getUpdates(offset: number = 0) {
  const response = await axios.get(`${MAX_API_URL}/updates`, {
    headers: { 'Authorization': BOT_TOKEN },
    params: { offset, limit: 100 },
  });
  
  return response.data.updates;
}

// –¶–∏–∫–ª –æ–ø—Ä–æ—Å–∞
async function startPolling() {
  let offset = 0;
  
  while (true) {
    try {
      const updates = await getUpdates(offset);
      
      for (const update of updates) {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        if (update.message) {
          await sendMessage(update.message.chat.id, '–ü–æ–ª—É—á–µ–Ω–æ!');
        }
        
        offset = update.update_id + 1;
      }
      
      await new Promise(resolve => setTimeout(resolve, 1000));
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ polling:', error);
    }
  }
}
```

---

## –≠—Ç–∞–ø 5: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 5.1 –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|-----|----------|---------|
| 401 | –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `Authorization` –∑–∞–≥–æ–ª–æ–≤–æ–∫ |
| 404 | –ß–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω | –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∞–ª –¥–∏–∞–ª–æ–≥ —Å –±–æ—Ç–æ–º |
| 429 | –ü—Ä–µ–≤—ã—à–µ–Ω rate limit | –î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ |
| 500 | –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ | –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ |

### 5.2 Retry-–ª–æ–≥–∏–∫–∞

```typescript
async function sendMessageWithRetry(
  chatId: string,
  text: string,
  maxRetries: number = 3
) {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await sendMessage(chatId, text);
    } catch (error) {
      if (attempt === maxRetries) throw error;
      
      const delay = Math.pow(2, attempt) * 1000; // Exponential backoff
      console.log(`–ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${delay}ms...`);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}
```

---

## –≠—Ç–∞–ø 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç—ã

### 6.1 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ CRM

```typescript
// –ü—Ä–∏–º–µ—Ä: –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ
async function notifyNewLead(leadData: any) {
  const adminChatId = process.env.ADMIN_CHAT_ID;
  
  const message = `
üÜï *–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞!*

üë§ –ò–º—è: ${leadData.name}
üìß Email: ${leadData.email}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${leadData.phone}
üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ: ${leadData.message}
  `.trim();
  
  await sendFormattedMessage(adminChatId, message);
}
```

### 6.2 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–º –¥–Ω–µ–≤–Ω–∏–∫–µ

```typescript
// –ü—Ä–∏–º–µ—Ä: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—è –æ –Ω–æ–≤–æ–π –æ—Ü–µ–Ω–∫–µ
async function notifyParentAboutGrade(parentChatId: string, grade: any) {
  const emoji = grade.value >= 4 ? '‚úÖ' : '‚ö†Ô∏è';
  
  const message = `
${emoji} *–ù–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ —É ${grade.studentName}*

üìö –ü—Ä–µ–¥–º–µ—Ç: ${grade.subject}
üìä –û—Ü–µ–Ω–∫–∞: ${grade.value}
üìÖ –î–∞—Ç–∞: ${new Date(grade.date).toLocaleDateString('ru-RU')}
  `.trim();
  
  await sendMessage(parentChatId, message);
}
```

### 6.3 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase Edge Functions

```typescript
// supabase/functions/max-notify/index.ts
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';

serve(async (req) => {
  const { chatId, message } = await req.json();
  
  const response = await fetch('https://platform-api.max.ru/messages', {
    method: 'POST',
    headers: {
      'Authorization': Deno.env.get('MAX_BOT_TOKEN')!,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      chat_id: chatId,
      text: message,
    }),
  });
  
  return new Response(JSON.stringify(await response.json()), {
    headers: { 'Content-Type': 'application/json' },
  });
});
```

---

## –≠—Ç–∞–ø 7: Best Practices

### 7.1 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è webhook
- ‚úÖ –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ webhook endpoint

### 7.2 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –°–æ–±–ª—é–¥–∞–π—Ç–µ rate limit (30 rps)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫
- ‚úÖ –ö—ç—à–∏—Ä—É–π—Ç–µ chat_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 7.3 UX
- ‚úÖ –î–æ–±–∞–≤–ª—è–π—Ç–µ —ç–º–æ–¥–∑–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç (–∂–∏—Ä–Ω—ã–π, –∫—É—Ä—Å–∏–≤)
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–æ 4096 —Å–∏–º–≤–æ–ª–æ–≤)

---

## –≠—Ç–∞–ø 8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 8.1 –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ ngrok –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ webhook
ngrok http 3000

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ webhook URL
curl -X POST https://platform-api.max.ru/subscriptions \
  -H "Authorization: YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://abc123.ngrok.io/webhook/max"}'
```

### 8.2 Unit-—Ç–µ—Å—Ç—ã

```typescript
import { describe, it, expect, vi } from 'vitest';

describe('MAX.ru Integration', () => {
  it('should send message successfully', async () => {
    const mockAxios = vi.spyOn(axios, 'post').mockResolvedValue({
      data: { message_id: '123' },
    });
    
    await sendMessage('test_chat', 'Hello');
    
    expect(mockAxios).toHaveBeenCalledWith(
      expect.stringContaining('/messages'),
      expect.objectContaining({ text: 'Hello' }),
      expect.any(Object)
    );
  });
});
```

---

## –≠—Ç–∞–ø 9: –î–µ–ø–ª–æ–π

### 9.1 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# Vercel
vercel env add MAX_BOT_TOKEN

# Railway
railway variables set MAX_BOT_TOKEN=your_token

# Docker
docker run -e MAX_BOT_TOKEN=your_token myapp
```

### 9.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```typescript
// Health check endpoint
app.get('/health/max', async (req, res) => {
  try {
    const response = await axios.get(`${MAX_API_URL}/me`, {
      headers: { 'Authorization': BOT_TOKEN },
    });
    
    res.json({
      status: 'ok',
      bot: response.data,
    });
  } catch (error) {
    res.status(500).json({ status: 'error', error: error.message });
  }
});
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://dev.max.ru/docs)
- [API Reference](https://dev.max.ru/docs-api)
- [TypeScript –±–∏–±–ª–∏–æ—Ç–µ–∫–∞](https://github.com/max-messenger/max-bot-api-client-ts)
- [Go –±–∏–±–ª–∏–æ—Ç–µ–∫–∞](https://github.com/max-messenger/max-bot-api-client-go)
- [–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤](https://partner.max.ru)

---

## –ß–µ–∫–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –±–æ—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ MAX –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤
- [ ] –ü–æ–ª—É—á–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω —Ç–æ–∫–µ–Ω –≤ `.env`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω webhook –∏–ª–∏ long polling
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry-–ª–æ–≥–∏–∫–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∫–Ω–æ–ø–æ–∫
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ use case
- [ ] –†–∞–∑–≤—ë—Ä–Ω—É—Ç–æ –Ω–∞ production —Å HTTPS
- [ ] –î–æ–±–∞–≤–ª–µ–Ω health check endpoint
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
